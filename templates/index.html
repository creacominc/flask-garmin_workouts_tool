<!-- Extend layout -->
{% extends "layout.html" %}

{% block body %}
  <h3>Workout List</h3>
  <div class="col-lg-12">
      {% for i in json_obj['com.garmin.connect.workout.dto.BaseUserWorkoutListDto']['baseUserWorkouts'] %}
      	<input type='button' onclick="location.href='download/{{ i['workoutId']|string }}';" value='Download' />
      	<input type='button' onclick="location.href='delete/{{ i['workoutId']|string }}';" value='Delete' />
      	{{i['workoutName'].encode('ascii', 'ignore').decode('ascii')}}
      	<br>
      {% endfor %}
      <br>
      <button id="show-workout-list-json">Show Workout List JSON</button>
      <div id="workout-list-json-field">
        <textarea name='result' rows='20' cols='80'>{{result}}</textarea>
      </div>
  </div>
  
  <h3>Upload a Workout</h3>
  <div class="col-lg-12">
      <input type="file" onchange="onFileSelected(event)">
      
      <form method="POST" action="{{ url_for('upload') }}">
        <div id='edit_field'>
          {{ upload_form.workout_json.label }} - Edit if desired
          <br>
          {{ upload_form.workout_json(cols="80", rows="20") }}
          <br>
          <input type="submit" value="Submit"/>
        </div>
      </form>

  </div>
  
  <script>
    function onFileSelected(event) {
    var selectedFile = event.target.files[0];
    var reader = new FileReader();
    var result = document.getElementById("workout_json");
    reader.onload = function(event) {
      result.innerHTML = event.target.result;
      result.rows = "20";
      result.cols = "80";
    };
    reader.readAsText(selectedFile);
    
    show(document.getElementById('edit_field'));
    }
    function hide (elements) {
      elements = elements.length ? elements : [elements];
      for (var index = 0; index < elements.length; index++) {
        elements[index].style.display = 'none';
      }
    }
    function show (elements, specifiedDisplay) {
      elements = elements.length ? elements : [elements];
      for (var index = 0; index < elements.length; index++) {
        elements[index].style.display = specifiedDisplay || 'block';
      }
    }

    window.onload = hide(document.getElementById('edit_field'));
    window.onload = hide(document.getElementById('workout-list-json-field'));

    document.getElementById('show-workout-list-json').addEventListener('click', function () {
    show(document.getElementById('workout-list-json-field'));
    });
  </script>
{% endblock %}